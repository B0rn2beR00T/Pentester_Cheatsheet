# Протокол SMB

## Поиск сетевых папок SMB. Перечисление шар и файлов

С помощью утилиты smbtree можно обнаружить компьютеры Windows с сетевыми шарами:
~~~bash
sudo smbtree -N
~~~
С помощью утилиты smbclient можно просмотреть имеющиеся на компьютере совместные папки:
~~~bash
sudo smbclient -L \\ИМЯ-КОМПЬЮТЕРА -N
~~~
Также с помощью smbclient, используя команду следующего вида, можно подключиться к сетевой папке и выполнить обычные файловые операции:
~~~bash
sudo smbclient //ИМЯ-КОМПЬЮТЕРА/Папка -N
~~~
В предыдущих двух командах используется опция -N для входа без пароля. Если вы хотите подключиться к папке, требующей аутентификации, то используйте опцию -U после которой укажите имя пользователя, а опцию -N уберите.

Поиск SMB по открытым портам
SMB использует порты 445 и 139, поэтому компьютеры с сетевыми шарами можно искать с помощью Nmap командой вида:
~~~bash
sudo nmap СЕТЬ -p 139,445
~~~
Например:
~~~bash
sudo nmap 192.168.0.0/24 -p 139,445
~~~

### enum4linux

Программа enum4linux задействует инструменты из пакета Samba для сбора информации используя общие папки Windows. Некоторые инструменты пакета Samba рассмотрены во второй части и вы можете применять их напрямую. С помощью enum4linux можно автоматизировать процесс.

Рассмотрим применение самых интересных опций. Во-первых, эта опция -a, которая означает собрать всю возможную информацию:
~~~bash
enum4linux -a 192.168.0.1
~~~
Некоторые системы настроены на анонимный вход, но при этом не разрешают вход без пароля — то есть в них запрещены нулевые сессии. Для обхода этой проблемы достаточно указать любое имя пользователя, пароль можно не указывать. Обратите внимание, что важно указать пользователя, который отсутствует в системе, где размещена общая папка, иначе доступ будет не разрешён из-за неверных учётных данных. Пользователя можно указать опцией -u:
~~~bash
enum4linux -a -u anyuser 192.168.0.101
~~~
Программа enum4linux обычно сама правильно определяет рабочую группу и указывать её вручную не требуется. Но я столкнулся с ситуацией, когда для хоста на Linux, где сетевая папка была настроена с помощью Samba, enum4linux не могла определить рабочую группу и выводила множество ошибок. Для принудительного указания рабочей группы используйте опцию -w:
~~~bash
enum4linux -a -w WORKGROUP 192.168.0.89
~~~
Если вы хотите только получить список совместных папок, то укажите опцию -S вместо -a:
~~~
enum4linux -S -u anyuser 192.168.0.101
~~~

Вывод:
![image](https://github.com/user-attachments/assets/61995105-e901-482d-88d8-e9ae5f007451)
